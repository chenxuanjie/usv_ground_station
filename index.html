<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>无人艇控制终端</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://lib.baomitu.com/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://lib.baomitu.com/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://lib.baomitu.com/babel-standalone/7.22.17/babel.min.js"></script>
    <style>
        /* 自定义滚动条 */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: #06b6d4; }
        
        /* 科技感网格背景 */
        .bg-grid {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
        }
        
        /* 扫描线动画 */
        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }
        .scan-effect::after {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to bottom, transparent, rgba(6, 182, 212, 0.1), transparent);
            animation: scanline 3s linear infinite;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 overflow-hidden font-sans selection:bg-cyan-500/30">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // 图标组件
        const Icons = {
            Activity: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
            Battery: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="10" x="2" y="7" rx="2" ry="2"/><line x1="22" x2="22" y1="11" y2="13"/></svg>,
            Settings: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Send: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>,
            RefreshCw: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
            ArrowUp: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m5 12 7-7 7 7"/><path d="M12 19V5"/></svg>,
            ArrowDown: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14"/><path d="m19 12-7 7-7-7"/></svg>,
            ArrowLeft: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            ArrowRight: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>,
            Navigation: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>,
            MapPin: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
            Video: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2" ry="2"/></svg>, // 补全了 Video 图标
        };

        function BoatGroundStation() {
            const [webConnected, setWebConnected] = useState(false);
            const [tcpStatus, setTcpStatus] = useState('OFFLINE'); 
            
            // 船的状态数据
            const [boatStatus, setBoatStatus] = useState({
                longitude: 0, latitude: 0, heading: 0,
                batteryL: 0, batteryR: 0,
                lastUpdate: null,
            });
            
            const [logs, setLogs] = useState([]);
            const [inputCmd, setInputCmd] = useState('');
            const wsRef = useRef(null);
            
            // 连接配置
            const [serverIp, setServerIp] = useState('120.77.0.8');
            const [serverPort, setServerPort] = useState('6202');
            const connectTimeoutRef = useRef(null);

            // 控制指令状态
            const [streamOn, setStreamOn] = useState(false);
            const [recvOn, setRecvOn] = useState(true);
            const [controlMode, setControlMode] = useState('@');
            const [cruiseMode, setCruiseMode] = useState('0');
            
            // 键盘按键状态
            const [keyState, setKeyState] = useState({ w: false, a: false, s: false, d: false });

            // 1. WebSocket 连接与数据处理逻辑
            useEffect(() => {
                const connectToBridge = () => {
                    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                    const wsUrl = `${protocol}//${window.location.host}`; 
                    const ws = new WebSocket(wsUrl);
                    
                    ws.onopen = () => {
                        setWebConnected(true);
                        ws.send("GET_CONFIG");
                        ws.send("CMD,QUERY_STATUS"); 
                    };

                    ws.onclose = () => {
                        setWebConnected(false);
                        setTcpStatus('OFFLINE');
                        addLog('SYS', 'Backend 连接已断开 (请手动刷新页面)');
                    };

                    ws.onmessage = (event) => {
                        const msg = event.data;
                        
                        if (msg.startsWith('CURRENT_CONFIG')) {
                            const parts = msg.split(',');
                            if (parts.length >= 3) {
                                setServerIp(parts[1]);
                                setServerPort(parts[2]);
                            }
                        } 
                        else if (msg.startsWith('TCP_STATUS')) {
                            const status = msg.split(',')[1]; 
                            clearTimeout(connectTimeoutRef.current);
                            
                            if (status === 'ONLINE') {
                                setTcpStatus('ONLINE');
                                addLog('SYS', '小艇连接成功！');
                            } else if (status === 'OFFLINE') {
                                setTcpStatus('OFFLINE');
                                addLog('SYS', '小艇连接已断开');
                            } else if (status === 'FAILED') {
                                setTcpStatus('OFFLINE');
                                addLog('ERR', '连接失败，请检查 IP/端口');
                                alert('连接失败！无法连接到目标设备。');
                            }
                        }
                        else if (msg.startsWith('R')) {
                            const parts = msg.split(',');
                            if (parts.length >= 6) {
                                setBoatStatus({
                                    longitude: parseFloat(parts[1]) || 0,
                                    latitude: parseFloat(parts[2]) || 0,
                                    heading: parseFloat(parts[3]) || 0,
                                    batteryL: parseFloat(parts[4]) || 0,
                                    batteryR: parseFloat(parts[5]) || 0,
                                    lastUpdate: new Date()
                                });
                            }
                        } else {
                            addLog('RX', msg);
                        }
                    };
                    wsRef.current = ws;
                };

                connectToBridge();

                return () => { 
                    if (wsRef.current) wsRef.current.close(); 
                    clearTimeout(connectTimeoutRef.current);
                };
            }, []);

            // 日志与发送辅助函数
            const addLog = (dir, msg) => {
                setLogs(prev => [{id: Date.now(), time: new Date().toLocaleTimeString(), dir, msg}, ...prev].slice(0, 50));
            };

            const sendData = (cmd) => {
                if (tcpStatus !== 'ONLINE' || !wsRef.current) return;
                const finalCmd = cmd.endsWith(',') ? cmd : cmd + ',';
                wsRef.current.send(finalCmd);
                addLog('TX', finalCmd);
            };

            const sendSCommand = () => sendData(`S,${streamOn ? '1':'0'},${recvOn ? '3':'2'},q,${controlMode},${cruiseMode},`);
            const sendKCommand = (w,a,s,d) => sendData(`K,${w},${a},${s},${d},`);

            // 2. 键盘监听逻辑
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.repeat) return; 
                    const key = e.key.toLowerCase();
                    
                    if (['w', 'a', 's', 'd'].includes(key)) {
                        setKeyState(prev => ({ ...prev, [key]: true }));
                        if (key === 'w') sendKCommand(1, 0, 0, 0);
                        if (key === 'a') sendKCommand(0, 1, 0, 0);
                        if (key === 's') sendKCommand(0, 0, 1, 0);
                        if (key === 'd') sendKCommand(0, 0, 0, 1);
                    }
                };

                const handleKeyUp = (e) => {
                    const key = e.key.toLowerCase();
                    if (['w', 'a', 's', 'd'].includes(key)) {
                        setKeyState(prev => ({ ...prev, [key]: false }));
                        sendKCommand(0, 0, 0, 0);
                    }
                };

                window.addEventListener('keydown', handleKeyDown);
                window.addEventListener('keyup', handleKeyUp);

                return () => {
                    window.removeEventListener('keydown', handleKeyDown);
                    window.removeEventListener('keyup', handleKeyUp);
                };
            }, [tcpStatus]); 

            // 连接按钮逻辑
            const toggleConnection = () => {
                if (!wsRef.current) return;

                if (tcpStatus === 'ONLINE') {
                    wsRef.current.send("CMD,DISCONNECT");
                } else if (tcpStatus === 'OFFLINE') {
                    setTcpStatus('CONNECTING');
                    addLog('SYS', `正在连接 ${serverIp}:${serverPort}...`);
                    wsRef.current.send(`CMD,CONNECT,${serverIp},${serverPort}`);
                    
                    if (connectTimeoutRef.current) clearTimeout(connectTimeoutRef.current);
                    connectTimeoutRef.current = setTimeout(() => {
                        if (tcpStatus !== 'ONLINE') {
                            setTcpStatus('OFFLINE');
                            addLog('ERR', '连接请求超时 (无响应)');
                            alert('连接超时！后端没有响应。');
                        }
                    }, 5000);
                }
            };

            const getBtnConfig = () => {
                if (tcpStatus === 'ONLINE') {
                    return { text: '断开连接', color: 'bg-red-600/90 hover:bg-red-700 border-red-500 shadow-red-900/50', disabled: false };
                }
                if (tcpStatus === 'CONNECTING') {
                    return { text: '连接中...', color: 'bg-yellow-600/90 border-yellow-500 shadow-yellow-900/50', disabled: true };
                }
                return { text: '连接设备', color: 'bg-cyan-600/90 hover:bg-cyan-500 border-cyan-400 shadow-cyan-900/50', disabled: false };
            };
            const btnConfig = getBtnConfig();

            return (
                <div className="flex flex-col h-screen bg-slate-950 text-slate-200 font-mono overflow-hidden relative bg-grid">
                    {/* 背景装饰光 */}
                    <div className="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-cyan-900/10 to-transparent pointer-events-none"></div>

                    {/* Header */}
                    <header className="h-14 bg-slate-900/80 border-b border-cyan-500/30 flex items-center px-4 justify-between shrink-0 backdrop-blur-md relative z-10">
                        <div className="flex items-center gap-2">
                            <div className="p-1.5 bg-cyan-500/10 border border-cyan-500/50 rounded">
                                <Icons.Activity className="w-5 h-5 text-cyan-400" />
                            </div>
                            <div>
                                <h1 className="text-lg font-black text-white tracking-wider italic">USV<span className="text-cyan-500">TERMINAL</span></h1>
                                <p className="text-[10px] text-cyan-500/60 -mt-1 tracking-widest uppercase">System Stable</p>
                            </div>
                        </div>
                        
                        <div className="flex items-center gap-3">
                            {/* IP 输入框组 */}
                            <div className="flex items-center bg-slate-950/50 border border-slate-700/50 rounded overflow-hidden group hover:border-cyan-500/50 transition-colors">
                                <span className="text-[10px] text-slate-500 px-2 bg-slate-900 border-r border-slate-800">TARGET</span>
                                <input 
                                    className="bg-transparent text-xs w-28 text-center focus:outline-none text-cyan-100 disabled:opacity-50 py-1" 
                                    value={serverIp} 
                                    onChange={e => setServerIp(e.target.value)} 
                                    disabled={tcpStatus !== 'OFFLINE'}
                                />
                                <div className="w-[1px] h-4 bg-slate-800"></div>
                                <input 
                                    className="bg-transparent text-xs w-14 text-center focus:outline-none text-cyan-100 disabled:opacity-50 py-1" 
                                    value={serverPort} 
                                    onChange={e => setServerPort(e.target.value)} 
                                    disabled={tcpStatus !== 'OFFLINE'}
                                />
                            </div>

                            <button 
                                onClick={toggleConnection}
                                disabled={!webConnected || btnConfig.disabled}
                                className={`${btnConfig.color} text-xs px-4 py-1.5 rounded border transition-all duration-300 min-w-[90px] font-bold shadow-[0_0_15px_rgba(0,0,0,0.3)] tracking-wide uppercase`}
                            >
                                {btnConfig.text}
                            </button>
                        </div>

                        <div className="flex items-center gap-6 text-xs font-bold">
                            <div className="flex items-center gap-2">
                                <div className={`w-2 h-2 rounded-full shadow-[0_0_8px] ${webConnected ? 'bg-green-500 shadow-green-500' : 'bg-red-500 shadow-red-500'}`}></div>
                                <span className="text-slate-400">WS_LINK</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className={`w-2 h-2 rounded-full shadow-[0_0_8px] ${tcpStatus === 'ONLINE' ? 'bg-cyan-400 shadow-cyan-400 animate-pulse' : (tcpStatus === 'CONNECTING' ? 'bg-yellow-500 shadow-yellow-500 animate-bounce' : 'bg-slate-600 shadow-none')}`}></div>
                                <span className="text-slate-400">TCP_LINK</span>
                            </div>
                        </div>
                    </header>

                    <div className="flex-1 flex overflow-hidden relative z-0">
                        {/* === Left Sidebar (Redesigned) === */}
                        <div className="w-80 bg-slate-950/80 border-r border-cyan-900/30 flex flex-col p-4 gap-4 overflow-y-auto backdrop-blur-sm scrollbar-hide">
                            
                            {/* Module 1: HUD Monitor (Combined GPS, Heading, Battery) */}
                            <div className="relative p-4 rounded-lg border border-cyan-500/30 bg-slate-900/90 shadow-[0_0_20px_rgba(6,182,212,0.05)] overflow-hidden group">
                                {/* 装饰角标 */}
                                <div className="absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-cyan-400"></div>
                                <div className="absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-cyan-400"></div>
                                <div className="absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent"></div>
                                
                                {/* 标题 */}
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xs font-bold text-cyan-500 tracking-widest uppercase flex items-center gap-2">
                                        <Icons.MapPin size={14}/> Status Monitor
                                    </h3>
                                    {!boatStatus.lastUpdate && <span className="text-[10px] text-yellow-500 animate-pulse">WAITING_DATA</span>}
                                </div>

                                {/* 罗盘与航向大数字 */}
                                <div className="flex items-center justify-between mb-6">
                                    <div className="relative w-16 h-16 border-2 border-slate-700 rounded-full flex items-center justify-center bg-slate-950 shadow-inner">
                                        <div className="absolute top-0 w-1 h-2 bg-cyan-400 z-10"></div> {/* 北标记 */}
                                        <div className="absolute inset-1 border border-dashed border-slate-600 rounded-full opacity-50"></div>
                                        {/* 动态旋转的箭头 */}
                                        <div style={{ transform: `rotate(${boatStatus.heading}deg)`, transition: 'transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)' }} className="w-full h-full flex items-center justify-center">
                                            <Icons.Navigation className="text-cyan-400 drop-shadow-[0_0_5px_rgba(34,211,238,0.8)]" size={24} />
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-4xl font-black text-white tracking-tighter drop-shadow-md">
                                            {boatStatus.heading.toFixed(1)}<span className="text-lg text-cyan-600 ml-1">°</span>
                                        </div>
                                        <div className="text-[10px] text-slate-500 uppercase tracking-widest mt-1">Current Heading</div>
                                    </div>
                                </div>

                                {/* 经纬度数据墙 */}
                                <div className="grid grid-cols-2 gap-2 text-xs font-mono bg-slate-950/50 p-2 rounded border border-slate-800 mb-4">
                                    <div className="flex flex-col">
                                        <span className="text-[10px] text-slate-500 mb-1">LATITUDE</span>
                                        <span className="text-cyan-100 font-bold">{boatStatus.latitude.toFixed(6)}</span>
                                    </div>
                                    <div className="flex flex-col text-right">
                                        <span className="text-[10px] text-slate-500 mb-1">LONGITUDE</span>
                                        <span className="text-cyan-100 font-bold">{boatStatus.longitude.toFixed(6)}</span>
                                    </div>
                                </div>

                                {/* 电池条 */}
                                <div className="space-y-3 pt-3 border-t border-slate-800/50">
                                    <div className="space-y-1">
                                        <div className="flex justify-between text-[10px] text-cyan-300 font-bold">
                                            <span>PWR_L</span>
                                            <span>{boatStatus.batteryL.toFixed(2)}V</span>
                                        </div>
                                        <div className="h-1.5 bg-slate-800 rounded-sm overflow-hidden relative">
                                            <div className="h-full bg-gradient-to-r from-cyan-600 to-cyan-400 shadow-[0_0_10px_rgba(6,182,212,0.5)] transition-all duration-1000" style={{width: `${(boatStatus.batteryL/14)*100}%`}}></div>
                                        </div>
                                    </div>
                                    <div className="space-y-1">
                                        <div className="flex justify-between text-[10px] text-cyan-300 font-bold">
                                            <span>PWR_R</span>
                                            <span>{boatStatus.batteryR.toFixed(2)}V</span>
                                        </div>
                                        <div className="h-1.5 bg-slate-800 rounded-sm overflow-hidden relative">
                                            <div className="h-full bg-gradient-to-r from-cyan-600 to-cyan-400 shadow-[0_0_10px_rgba(6,182,212,0.5)] transition-all duration-1000" style={{width: `${(boatStatus.batteryR/14)*100}%`}}></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {/* Module 2: Controls Config */}
                            <div className="p-4 rounded-lg border border-slate-800 bg-slate-900/50 hover:border-slate-700 transition-colors">
                                <h3 className="text-xs font-bold text-slate-400 mb-3 flex items-center gap-2 uppercase tracking-wider">
                                    <Icons.Settings size={14}/> System Config
                                </h3>
                                <div className="space-y-2">
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => setStreamOn(!streamOn)} className={`p-1.5 rounded border text-[10px] font-bold transition-all ${streamOn?'bg-cyan-500/20 border-cyan-500 text-cyan-300 shadow-[0_0_10px_rgba(6,182,212,0.2)]':'border-slate-700 text-slate-500 hover:border-slate-500'}`}>{streamOn?'STREAM: ON':'STREAM: OFF'}</button>
                                        <button onClick={() => setRecvOn(!recvOn)} className={`p-1.5 rounded border text-[10px] font-bold transition-all ${recvOn?'bg-cyan-500/20 border-cyan-500 text-cyan-300 shadow-[0_0_10px_rgba(6,182,212,0.2)]':'border-slate-700 text-slate-500 hover:border-slate-500'}`}>{recvOn?'RECV: ON':'RECV: OFF'}</button>
                                    </div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => setControlMode('#')} className={`p-1.5 rounded border text-[10px] font-bold transition-all ${controlMode==='#'?'bg-cyan-500/20 border-cyan-500 text-cyan-300':'border-slate-700 text-slate-500 hover:border-slate-500'}`}>MODE: AUTO (#)</button>
                                        <button onClick={() => setControlMode('@')} className={`p-1.5 rounded border text-[10px] font-bold transition-all ${controlMode==='@'?'bg-cyan-500/20 border-cyan-500 text-cyan-300':'border-slate-700 text-slate-500 hover:border-slate-500'}`}>MODE: MANUAL (@)</button>
                                    </div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => setCruiseMode('1')} className={`p-1.5 rounded border text-[10px] font-bold transition-all ${cruiseMode==='1'?'bg-cyan-500/20 border-cyan-500 text-cyan-300':'border-slate-700 text-slate-500 hover:border-slate-500'}`}>LOOP: ON (1)</button>
                                        <button onClick={() => setCruiseMode('0')} className={`p-1.5 rounded border text-[10px] font-bold transition-all ${cruiseMode==='0'?'bg-cyan-500/20 border-cyan-500 text-cyan-300':'border-slate-700 text-slate-500 hover:border-slate-500'}`}>LOOP: OFF (0)</button>
                                    </div>
                                    <button onClick={sendSCommand} className="w-full mt-2 bg-gradient-to-r from-cyan-600 to-cyan-500 hover:from-cyan-500 hover:to-cyan-400 text-white text-xs py-2 rounded font-bold shadow-lg tracking-wide">DEPLOY CONFIG</button>
                                </div>
                            </div>

                            {/* Module 3: Remote Control */}
                            <div className="p-4 rounded-lg border border-slate-800 bg-slate-900/50 flex flex-col items-center relative">
                                <div className="absolute top-2 left-2 text-[10px] text-slate-600 font-bold uppercase tracking-widest">Manual Override</div>
                                <div className="grid grid-cols-3 gap-2 mt-4">
                                    <div/>
                                    <button 
                                        onMouseDown={()=>sendKCommand(1,0,0,0)} 
                                        onMouseUp={()=>sendKCommand(0,0,0,0)} 
                                        className={`w-14 h-14 border-2 rounded-lg flex items-center justify-center transition-all duration-100 ${keyState.w ? 'bg-cyan-500 border-cyan-300 text-white shadow-[0_0_15px_rgba(6,182,212,0.6)] scale-95' : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700 hover:border-slate-500'}`}
                                    >
                                        <Icons.ArrowUp size={24}/>
                                    </button>
                                    <div/>
                                    
                                    <button 
                                        onMouseDown={()=>sendKCommand(0,1,0,0)} 
                                        onMouseUp={()=>sendKCommand(0,0,0,0)} 
                                        className={`w-14 h-14 border-2 rounded-lg flex items-center justify-center transition-all duration-100 ${keyState.a ? 'bg-cyan-500 border-cyan-300 text-white shadow-[0_0_15px_rgba(6,182,212,0.6)] scale-95' : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700 hover:border-slate-500'}`}
                                    >
                                        <Icons.ArrowLeft size={24}/>
                                    </button>
                                    
                                    <button 
                                        onMouseDown={()=>sendKCommand(0,0,1,0)} 
                                        onMouseUp={()=>sendKCommand(0,0,0,0)} 
                                        className={`w-14 h-14 border-2 rounded-lg flex items-center justify-center transition-all duration-100 ${keyState.s ? 'bg-cyan-500 border-cyan-300 text-white shadow-[0_0_15px_rgba(6,182,212,0.6)] scale-95' : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700 hover:border-slate-500'}`}
                                    >
                                        <Icons.ArrowDown size={24}/>
                                    </button>
                                    
                                    <button 
                                        onMouseDown={()=>sendKCommand(0,0,0,1)} 
                                        onMouseUp={()=>sendKCommand(0,0,0,0)} 
                                        className={`w-14 h-14 border-2 rounded-lg flex items-center justify-center transition-all duration-100 ${keyState.d ? 'bg-cyan-500 border-cyan-300 text-white shadow-[0_0_15px_rgba(6,182,212,0.6)] scale-95' : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700 hover:border-slate-500'}`}
                                    >
                                        <Icons.ArrowRight size={24}/>
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Center Area (Now clean, just placeholders) */}
                        <div className="flex-1 bg-slate-900/50 relative flex items-center justify-center border-x border-cyan-900/10 scan-effect overflow-hidden">
                             {/* 这里可以放视频流 */}
                             <div className="absolute top-4 left-4 flex gap-2">
                                 <div className="bg-black/40 backdrop-blur border border-white/10 px-3 py-1 text-xs rounded text-slate-400">Main Camera</div>
                                 <div className="bg-black/40 backdrop-blur border border-white/10 px-3 py-1 text-xs rounded text-slate-400">Map View</div>
                             </div>
                             
                             <div className="text-center opacity-30 pointer-events-none">
                                <Icons.Video size={64} className="mx-auto text-cyan-800 mb-4"/>
                                <div className="text-xl font-bold text-cyan-800 tracking-widest">NO SIGNAL INPUT</div>
                             </div>
                        </div>

                        {/* Right Logs (Styled) */}
                        <div className="w-72 bg-slate-950/80 flex flex-col text-xs border-l border-cyan-900/30 backdrop-blur-sm">
                            <div className="p-3 border-b border-cyan-900/30 flex justify-between items-center bg-slate-900/80">
                                <span className="font-bold text-cyan-500 tracking-wider flex items-center gap-2"><Icons.Activity size={14}/> SYSTEM LOGS</span>
                                <button onClick={()=>setLogs([])} className="text-slate-500 hover:text-white transition-colors"><Icons.RefreshCw size={12}/></button>
                            </div>
                            <div className="flex-1 overflow-y-auto p-3 font-mono space-y-2">
                                {logs.map(log => (
                                    <div key={log.id} className="break-all border-l-2 pl-2 text-[10px] leading-relaxed transition-all animate-[fadeIn_0.3s_ease-out]" 
                                         style={{borderColor: log.dir==='TX'?'#10b981':(log.dir==='ERR'?'#ef4444':(log.dir==='RX'?'#3b82f6':'#64748b'))}}>
                                        <div className="flex justify-between opacity-50 mb-0.5">
                                            <span>{log.time}</span>
                                            <span>{log.dir}</span>
                                        </div>
                                        <span className={log.dir==='TX'?'text-green-400':(log.dir==='ERR'?'text-red-400':(log.dir==='RX'?'text-blue-300':'text-slate-300'))}> {log.msg}</span>
                                    </div>
                                ))}
                            </div>
                            <div className="p-3 border-t border-cyan-900/30 bg-slate-900/90">
                                <div className="flex items-center bg-slate-950 border border-slate-800 rounded px-2 py-1 focus-within:border-cyan-500/50 transition-colors">
                                    <span className="text-cyan-500 mr-2">$</span>
                                    <input value={inputCmd} onChange={e=>setInputCmd(e.target.value)} className="flex-1 bg-transparent outline-none p-1 text-cyan-100 placeholder-slate-700" placeholder="Execute command..." />
                                    <button onClick={()=>{sendData(inputCmd);setInputCmd('')}} className="text-cyan-500 hover:text-cyan-300"><Icons.Send size={14}/></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BoatGroundStation />);
    </script>
</body>
</html>